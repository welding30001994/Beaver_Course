<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente de Trading con Voz</title>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Exo 2', sans-serif;
            background: url('https://raw.githubusercontent.com/welding30001994/vip/refs/heads/main/unnamed%20(1).jpg') no-repeat center center fixed;
            background-size: cover;
            color: #fff;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
            margin: 0;
        }

        /* Capa oscura sobre la imagen de fondo */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: -1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #4FC3F7;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .subtitle {
            font-size: 1.2rem;
            color: #B3E5FC;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 70vh;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 18px;
            line-height: 1.4;
            position: relative;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, #1E88E5, #0D47A1);
            border-bottom-right-radius: 5px;
        }

        .assistant-message {
            align-self: flex-start;
            background: rgba(30, 30, 40, 0.8);
            border-bottom-left-radius: 5px;
            border: 1px solid rgba(100, 100, 150, 0.3);
        }

        .input-area {
            display: flex;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        #user-input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            outline: none;
        }

        #user-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        #send-btn {
            background: #1E88E5;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }

        #send-btn:hover {
            background: #1565C0;
        }

        .voice-controls {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            gap: 10px;
        }

        .voice-btn {
            background: rgba(30, 30, 40, 0.8);
            color: white;
            border: 1px solid rgba(100, 100, 150, 0.5);
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .voice-btn:hover {
            background: rgba(50, 50, 70, 0.8);
        }

        .voice-btn.active {
            background: #E91E63;
        }

        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .quick-btn {
            background: rgba(30, 30, 40, 0.7);
            color: white;
            border: 1px solid rgba(100, 100, 150, 0.3);
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .quick-btn:hover {
            background: rgba(50, 50, 70, 0.7);
            transform: translateY(-2px);
        }

        .typing-indicator {
            display: none;
            align-self: flex-start;
            background: rgba(30, 30, 40, 0.8);
            padding: 12px 18px;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            margin-bottom: 10px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @media (max-width: 768px) {
            .message {
                max-width: 90%;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Beaver Trading</h1>
            <p class="subtitle">Consulta información sobre indicadores técnicos y recibe respuestas habladas</p>
        </header>

        <div class="chat-container">
            <div class="chat-messages" id="chat-messages">
                <div class="message assistant-message">
                    ¡Hola! Soy tu asistente de trading. Puedes preguntarme sobre cualquier indicador técnico: tendencia, momentum, volatilidad, volumen, osciladores avanzados o patrones y ciclos. También puedo leer las respuestas en voz alta.
                </div>
            </div>
            
            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            
            <div class="input-area">
                <input type="text" id="user-input" placeholder="Escribe tu pregunta sobre indicadores de trading...">
                <button id="send-btn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2 21L23 12L2 3V10L17 12L2 14V21Z" fill="white"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="voice-controls">
            <button id="voice-toggle" class="voice-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 15C13.6569 15 15 13.6569 15 12V5C15 3.34315 13.6569 2 12 2C10.3431 2 9 3.34315 9 5V12C9 13.6569 10.3431 15 12 15Z" fill="currentColor"/>
                    <path d="M17 12C17 14.7614 14.7614 17 12 17C9.23858 17 7 14.7614 7 12M12 19V22M5 22H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Voz: OFF
            </button>
            <button id="test-voice" class="voice-btn">
                Probar voz
            </button>
        </div>

        <div class="quick-actions">
            <div class="quick-btn" data-query="¿Qué es el RSI?">RSI</div>
            <div class="quick-btn" data-query="¿Cómo funciona el MACD?">MACD</div>
            <div class="quick-btn" data-query="¿Para qué sirven las Bandas de Bollinger?">Bollinger Bands</div>
            <div class="quick-btn" data-query="Explica el indicador ADX">ADX</div>
            <div class="quick-btn" data-query="¿Qué mide el volumen en trading?">Volumen</div>
            <div class="quick-btn" data-query="Diferencia entre SMA y EMA">SMA vs EMA</div>
            <div class="quick-btn" data-query="¿Cómo usar Fibonacci en trading?">Fibonacci</div>
            <div class="quick-btn" data-query="Lista todos los tipos de indicadores">Tipos de indicadores</div>
        </div>
    </div>

    <script>
        // Base de conocimiento de indicadores de trading
        const tradingKnowledge = {
            "tendencia": {
                "sma": {
                    nombre: "Media Móvil Simple (SMA)",
                    descripcion: "Promedia los precios de cierre de un activo durante un período específico. Suaviza las fluctuaciones de precio para mostrar la dirección general de la tendencia.",
                    formula: "SMA = (P1 + P2 + ... + Pn) / n, donde P es el precio de cierre y n es el número de períodos.",
                    uso: "Identificar la dirección de la tendencia y posibles niveles de soporte/resistencia.",
                    señales: "Cruce de precios por encima/abajo de la SMA indica cambio potencial de tendencia."
                },
                "ema": {
                    nombre: "Media Móvil Exponencial (EMA)",
                    descripcion: "Similar a la SMA pero da más peso a los precios recientes, lo que la hace más sensible a los cambios recientes de precio.",
                    formula: "EMA = (Precio actual * (2/(n+1))) + (EMA anterior * (1 - (2/(n+1))))",
                    uso: "Detectar cambios de tendencia más rápidamente que con la SMA.",
                    señales: "Similar a SMA, pero con respuestas más rápidas a cambios de precio."
                },
                "sar": {
                    nombre: "Parabolic SAR",
                    descripcion: "Indica puntos de stop y reversa. Aparece como puntos por encima o debajo del precio, mostrando la dirección de la tendencia.",
                    uso: "Identificar puntos de entrada y salida, y cambios de tendencia.",
                    señales: "Cuando los puntos pasan de estar debajo a encima del precio, indica posible cambio a tendencia bajista."
                },
                "macd": {
                    nombre: "MACD (Moving Average Convergence Divergence)",
                    descripcion: "Muestra la relación entre dos medias móviles exponenciales. Consiste en el MACD, la línea de señal y el histograma.",
                    formula: "MACD = EMA(12) - EMA(26), Señal = EMA(9) del MACD, Histograma = MACD - Señal",
                    uso: "Identificar cambios de tendencia, momentum y posibles puntos de entrada.",
                    señales: "Cruce del MACD por encima/abajo de la línea de señal indica compra/venta."
                },
                "adx": {
                    nombre: "ADX (Average Directional Index)",
                    descripcion: "Mide la fuerza de una tendencia, no su dirección. Valores por encima de 25 indican tendencia fuerte.",
                    uso: "Determinar si un mercado está en tendencia o lateral.",
                    señales: "ADX > 25 = tendencia fuerte, ADX < 20 = mercado lateral."
                },
                "ichimoku": {
                    nombre: "Ichimoku Kinko Hyo",
                    descripcion: "Sistema completo de análisis que muestra tendencia, soporte/resistencia y momentum en una sola vista.",
                    componentes: "Línea de Conversión, Línea de Base, Nube, Línea de Retraso",
                    uso: "Análisis completo del mercado con un solo indicador.",
                    señales: "Precio por encima/abajo de la nube indica tendencia alcista/bajista."
                }
            },
            "momentum": {
                "rsi": {
                    nombre: "RSI (Relative Strength Index)",
                    descripcion: "Oscilador que mula la velocidad y cambio de movimientos de precio. Rango de 0 a 100.",
                    formula: "RSI = 100 - (100 / (1 + RS)), donde RS = Promedio de ganancias / Promedio de pérdidas",
                    uso: "Identificar condiciones de sobrecompra (>70) y sobreventa (<30).",
                    señales: "Divergencias entre RSI y precio pueden indicar reversiones."
                },
                "stochastic": {
                    nombre: "Estocástico (Stochastic Oscillator)",
                    descripcion: "Compara el precio de cierre con el rango de precios durante un período específico.",
                    formula: "%K = 100 * (C - L14) / (H14 - L14), donde C=precio actual, L14=mínimo de 14 períodos, H14=máximo de 14 períodos",
                    uso: "Identificar puntos de reversión y condiciones de sobrecompra/sobreventa.",
                    señales: "Cruce de %K por encima/abajo de %D en zonas extremas indica posibles reversiones."
                },
                "cci": {
                    nombre: "CCI (Commodity Channel Index)",
                    descripcion: "Mide la desviación del precio de su media estadística.",
                    uso: "Identificar ciclos de precios y condiciones extremas.",
                    señales: "Valores por encima de +100 indican fortaleza, por debajo de -100 indican debilidad."
                },
                "roc": {
                    nombre: "ROC (Rate of Change)",
                    descripcion: "Mide el cambio porcentual en el precio entre el período actual y uno anterior.",
                    formula: "ROC = ((Precio actual - Precio de n períodos atrás) / Precio de n períodos atrás) * 100",
                    uso: "Medir la velocidad del cambio de precio.",
                    señales: "Cambios bruscos pueden indicar aceleración del momentum."
                },
                "momentum": {
                    nombre: "Momentum",
                    descripcion: "Mide la tasa de cambio del precio comparando el precio actual con el de hace n períodos.",
                    formula: "Momentum = Precio actual - Precio de n períodos atrás",
                    uso: "Identificar la fuerza detrás de los movimientos de precio.",
                    señales: "Valores positivos indican momentum alcista, negativos indican momentum bajista."
                }
            },
            "volatilidad": {
                "bollinger": {
                    nombre: "Bandas de Bollinger (Bollinger Bands)",
                    descripcion: "Consiste en una media móvil central con dos bandas que representan desviaciones estándar.",
                    formula: "Banda superior = SMA + (2 * Desviación estándar), Banda inferior = SMA - (2 * Desviación estándar)",
                    uso: "Medir volatilidad y identificar condiciones extremas.",
                    señales: "Precio tocando las bandas puede indicar continuación o reversión."
                },
                "atr": {
                    nombre: "ATR (Average True Range)",
                    descripcion: "Mide la volatilidad considerando los rangos verdaderos de precio.",
                    formula: "TR = Máximo(H-L, |H-C anterior|, |L-C anterior|), ATR = Media móvil de TR",
                    uso: "Establecer stops y objetivos basados en la volatilidad actual.",
                    señales: "ATR alto = alta volatilidad, ATR bajo = baja volatilidad."
                },
                "donchian": {
                    nombre: "Canal de Donchian (Donchian Channel)",
                    descripcion: "Muestra el máximo y mínimo de los últimos n períodos.",
                    uso: "Identificar rupturas y tendencias.",
                    señales: "Ruptura por encima/abajo del canal indica posible inicio de tendencia."
                },
                "keltner": {
                    nombre: "Canal de Keltner (Keltner Channel)",
                    descripcion: "Similar a Bollinger Bands pero usa ATR para las bandas en lugar de desviación estándar.",
                    formula: "Banda media = EMA, Bandas = EMA ± (Multiplicador * ATR)",
                    uso: "Identificar tendencias y condiciones extremas.",
                    señales: "Similar a Bollinger Bands pero generalmente más suave."
                }
            },
            "volumen": {
                "volume": {
                    nombre: "Volumen",
                    descripcion: "Cantidad de contratos o acciones negociadas en un período.",
                    uso: "Confirmar la fortaleza de movimientos de precio.",
                    señales: "Movimientos con alto volumen tienen más validez."
                },
                "obv": {
                    nombre: "OBV (On Balance Volume)",
                    descripcion: "Acumula volumen en días alcistas y resta en días bajistas.",
                    formula: "Si precio actual > precio anterior: OBV = OBV anterior + volumen, Si precio actual < precio anterior: OBV = OBV anterior - volumen",
                    uso: "Confirmar tendencias y detectar divergencias.",
                    señales: "Divergencia entre OBV y precio puede indicar debilidad de tendencia."
                },
                "cmf": {
                    nombre: "CMF (Chaikin Money Flow)",
                    descripcion: "Mide el flujo de dinero en o fuera de un activo.",
                    formula: "CMF = Suma((((C-L)-(H-C))/(H-L)) * Volumen) / Suma(volumen) durante n períodos",
                    uso: "Identificar presión compradora o vendedora.",
                    señales: "Valores positivos indican acumulación, negativos indican distribución."
                },
                "ad": {
                    nombre: "A/D (Accumulation/Distribution)",
                    descripcion: "Similar al OBV pero considera el rango de precios.",
                    formula: "MFM = ((C-L)-(H-C))/(H-L), A/D = A/D anterior + (MFM * Volumen)",
                    uso: "Identificar acumulación (compras institucionales) o distribución (ventas).",
                    señales: "Tendencia alcista en A/D confirma tendencia alcista en precio."
                }
            },
            "osciladores": {
                "macd histogram": {
                    nombre: "MACD Histogram",
                    descripcion: "Representa la diferencia entre el MACD y su línea de señal.",
                    uso: "Anticipar cruces del MACD.",
                    señales: "Cambio de dirección del histograma puede preceder a cruces del MACD."
                },
                "williams": {
                    nombre: "Williams %R",
                    descripcion: "Similar al estocástico pero invertido (0 a -100).",
                    formula: "%R = ((H14 - C) / (H14 - L14)) * -100",
                    uso: "Identificar condiciones de sobrecompra (>-20) y sobreventa (<-80).",
                    señales: "Salida de zonas extremas puede indicar posibles entradas."
                },
                "ultimate": {
                    nombre: "Ultimate Oscillator",
                    descripcion: "Combina tres períodos diferentes para reducir señales falsas.",
                    uso: "Identificar momentum con menos ruido.",
                    señales: "Divergencias y cruces de niveles clave proporcionan señales."
                },
                "trix": {
                    nombre: "TRIX (Triple Exponential Average)",
                    descripcion: "Muestra el cambio porcentual de una media móvil exponencial triple.",
                    uso: "Filtrar ruido del mercado para tendencias a largo plazo.",
                    señales: "Cruces por encima/abajo de cero indican cambios de tendencia."
                }
            },
            "patrones": {
                "fibonacci": {
                    nombre: "Retrocesos de Fibonacci",
                    descripcion: "Usa ratios matemáticos (23.6%, 38.2%, 50%, 61.8%, 78.6%) para identificar niveles de soporte/resistencia.",
                    uso: "Predecir posibles niveles de corrección en una tendencia.",
                    señales: "Rebotes o rupturas en niveles Fibonacci pueden indicar continuación o reversión."
                },
                "elliott": {
                    nombre: "Ondas de Elliott",
                    descripcion: "Teoría que postula que los mercados se mueven en patrones de 5 ondas en dirección de la tendencia y 3 ondas correctivas.",
                    uso: "Identificar fases del mercado y predecir movimientos futuros.",
                    señales: "Completación de patrones de onda indica posibles cambios de dirección."
                },
                "gann": {
                    nombre: "Ángulos de Gann (Gann Fan)",
                    descripcion: "Usa ángulos geométricos para predecir soportes y resistencias futuros.",
                    uso: "Proyectar niveles de precio y tiempo.",
                    señales: "Precio respetando ángulos de Gann confirma tendencia."
                },
                "pivot": {
                    nombre: "Puntos Pivote (Pivot Points)",
                    descripcion: "Calcula niveles de soporte y resistencia basados en el máximo, mínimo y cierre del día anterior.",
                    formula: "Pivote = (H + L + C) / 3, R1 = (2*P) - L, S1 = (2*P) - H, etc.",
                    uso: "Identificar niveles clave para el trading intradía.",
                    señales: "Rebotes o rupturas en niveles pivote indican dirección del día."
                }
            }
        };

        // Elementos del DOM
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const voiceToggle = document.getElementById('voice-toggle');
        const testVoice = document.getElementById('test-voice');
        const typingIndicator = document.getElementById('typing-indicator');
        const quickBtns = document.querySelectorAll('.quick-btn');

        // Estado de voz
        let voiceEnabled = false;
        let speechSynthesis = window.speechSynthesis;

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar compatibilidad con síntesis de voz
            if (!speechSynthesis) {
                voiceToggle.disabled = true;
                voiceToggle.innerHTML = 'Voz no compatible';
            }
            
            // Event listeners
            sendBtn.addEventListener('click', sendMessage);
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
            
            voiceToggle.addEventListener('click', toggleVoice);
            testVoice.addEventListener('click', testVoiceFunction);
            
            // Botones rápidos
            quickBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    userInput.value = this.getAttribute('data-query');
                    sendMessage();
                });
            });
        });

        // Función para enviar mensaje
        function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            // Agregar mensaje del usuario
            addMessage(message, 'user');
            userInput.value = '';
            
            // Mostrar indicador de escritura
            showTypingIndicator();
            
            // Procesar después de un breve retraso (simular procesamiento)
            setTimeout(() => {
                hideTypingIndicator();
                const response = generateResponse(message);
                addMessage(response, 'assistant');
                
                // Leer respuesta si la voz está habilitada
                if (voiceEnabled) {
                    speakText(response);
                }
            }, 1000);
        }

        // Función para agregar mensaje al chat
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(sender === 'user' ? 'user-message' : 'assistant-message');
            messageDiv.textContent = text;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Función para mostrar indicador de escritura
        function showTypingIndicator() {
            typingIndicator.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Función para ocultar indicador de escritura
        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        // Función para generar respuesta
        function generateResponse(query) {
            query = query.toLowerCase();
            
            // Buscar coincidencias en la base de conocimiento
            for (const category in tradingKnowledge) {
                for (const indicator in tradingKnowledge[category]) {
                    const indicatorData = tradingKnowledge[category][indicator];
                    const indicatorName = indicatorData.nombre.toLowerCase();
                    
                    if (query.includes(indicator) || query.includes(indicatorName) || 
                        indicatorName.includes(query) || query.includes(indicatorData.nombre.split(' ')[0].toLowerCase())) {
                        
                        return formatIndicatorResponse(indicatorData);
                    }
                }
            }
            
            // Respuestas para consultas generales
            if (query.includes('hola') || query.includes('hi') || query.includes('hello')) {
                return "¡Hola! Soy tu asistente de trading. Puedes preguntarme sobre cualquier indicador técnico. Por ejemplo: '¿Qué es el RSI?' o 'Explícame las Bandas de Bollinger'.";
            }
            
            if (query.includes('tipos') || query.includes('clases') || query.includes('categorías')) {
                return "Los indicadores técnicos se clasifican en:\n\n1. Tendencia (SMA, EMA, MACD, ADX, etc.)\n2. Momentum (RSI, Estocástico, CCI, etc.)\n3. Volatilidad (Bollinger Bands, ATR, etc.)\n4. Volumen (OBV, CMF, A/D, etc.)\n5. Osciladores avanzados (Williams %R, Ultimate Oscillator, etc.)\n6. Patrones y ciclos (Fibonacci, Elliott, etc.)\n\n¿Sobre cuál te gustaría saber más?";
            }
            
            if (query.includes('gracias') || query.includes('thanks')) {
                return "¡De nada! Estoy aquí para ayudarte con cualquier duda sobre indicadores de trading.";
            }
            
            // Respuesta por defecto
            return "No estoy seguro de entender tu pregunta. Puedes preguntar sobre indicadores específicos como RSI, MACD, Bandas de Bollinger, Fibonacci, etc. O preguntar por 'tipos de indicadores' para ver una lista completa.";
        }

        // Función para formatear la respuesta de un indicador
        function formatIndicatorResponse(indicatorData) {
            let response = `**${indicatorData.nombre}**\n\n`;
            response += `**Descripción:** ${indicatorData.descripcion}\n\n`;
            
            if (indicatorData.formula) {
                response += `**Fórmula:** ${indicatorData.formula}\n\n`;
            }
            
            if (indicatorData.uso) {
                response += `**Uso principal:** ${indicatorData.uso}\n\n`;
            }
            
            if (indicatorData.señales) {
                response += `**Señales de trading:** ${indicatorData.señales}\n\n`;
            }
            
            response += "¿Necesitas más detalles sobre este indicador o prefieres información sobre otro?";
            
            return response;
        }

        // Función para alternar la voz
        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            voiceToggle.classList.toggle('active', voiceEnabled);
            voiceToggle.innerHTML = voiceEnabled ? 
                '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 15C13.6569 15 15 13.6569 15 12V5C15 3.34315 13.6569 2 12 2C10.3431 2 9 3.34315 9 5V12C9 13.6569 10.3431 15 12 15Z" fill="currentColor"/><path d="M17 12C17 14.7614 14.7614 17 12 17C9.23858 17 7 14.7614 7 12M12 19V22M5 22H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg> Voz: ON' : 
                '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 15C13.6569 15 15 13.6569 15 12V5C15 3.34315 13.6569 2 12 2C10.3431 2 9 3.34315 9 5V12C9 13.6569 10.3431 15 12 15Z" fill="currentColor"/><path d="M17 12C17 14.7614 14.7614 17 12 17C9.23858 17 7 14.7614 7 12M12 19V22M5 22H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg> Voz: OFF';
        }

        // Función para probar la voz
        function testVoiceFunction() {
            if (!voiceEnabled) {
                addMessage("Primero activa la función de voz usando el botón 'Voz: ON'.", 'assistant');
                return;
            }
            
            const testText = "¡Hola! Esta es una prueba de la función de voz. Si puedes escuchar este mensaje, la síntesis de voz está funcionando correctamente.";
            speakText(testText);
            addMessage("Reproduciendo prueba de voz...", 'assistant');
        }

        // Función para leer texto en voz alta
        function speakText(text) {
            if (!speechSynthesis) return;
            
            // Cancelar cualquier speech en curso
            speechSynthesis.cancel();
            
            // Crear utterance
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'es-ES';
            utterance.rate = 1.0;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            // Seleccionar voz en español si está disponible
            const voices = speechSynthesis.getVoices();
            const spanishVoice = voices.find(voice => voice.lang.startsWith('es'));
            if (spanishVoice) {
                utterance.voice = spanishVoice;
            }
            
            // Reproducir
            speechSynthesis.speak(utterance);
        }

        // Cargar voces cuando estén disponibles
        if (speechSynthesis) {
            speechSynthesis.onvoiceschanged = function() {
                // Voces cargadas, listas para usar
            };
        }
    </script>
</body>
</html>